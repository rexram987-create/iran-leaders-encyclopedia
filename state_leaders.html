import React, { useState, useEffect, useMemo } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, collection, doc, setDoc, onSnapshot, getDocs } from 'firebase/firestore';
import { Home, ShieldCheck, UserCheck, Search, X, Fingerprint, BookOpen, Pocket, Award, History, ZoomIn, Loader2, Database, Binary, Cpu } from 'lucide-react';

// --- Firebase Configuration ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'leaders-research-v2';

const App = () => {
  const [user, setUser] = useState(null);
  const [leaders, setLeaders] = useState([]);
  const [selectedLeader, setSelectedLeader] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [loading, setLoading] = useState(true);
  const [zoomedImage, setZoomedImage] = useState(null);

  const initialResearchData = useMemo(() => [
    {
      id: "leader_1",
      fullName: "סייד רוחאללה מוסאווי ח'ומייני",
      role: "מייסד המהפכה האסלאמית והמנהיג העליון הראשון",
      years: "1902–1989",
      imageUrl: "https://i.postimg.cc/zLrpCKBF/1770134682965.png",
      etymology: [
        { label: "מעמד דתי: סייד (Sayyid)", content: "התואר הבכיר ביותר בהיררכיה השיעית, המציין ייחוס דם מוכח (Shajara) לנביא מוחמד דרך בתו פאטמה והאימאם עלי. בקרב השיעה האיראנית, הסיידים נחשבים ל'אצולת הקדושה'. ח'ומייני עטה את הטורבן השחור כעדות חזותית לייחוסו, המעניק לו לגיטימציה שלטונית שאינה נובעת מרצון העם אלא מרצון האל, כמי שמזרע הנביא." },
        { label: "שם פרטי: רוחאללה (Ruhollah)", content: "משמעות מיסטית: 'רוח האל'. במחשבה האסלאמית והאירפנית, זהו תואר המיוחס לעיסא (ישו), שנחשב למי שהופחה בו רוח אלוהית. השם מרמז על אדם שקיומו הגשמי הוא רק כסות למהות רוחנית עליונה, וכי כל פועלו מונחה על ידי הדרכה אלוהית ישירה." },
        { label: "שושלת דם: מוסאווי (Mousavi)", content: "מציין ייחוס גנטי מפורש לאימאם השביעי, מוסא אל-כאז'ם. השושלת המוסאווית נחשבת ליוקרתית במיוחד בקרב הסיידים, שכן האימאם מוסא אל-כאז'ם ידוע כסמל של סבל ועמידה איתנה בכלא. ייחוס זה הציב את ח'ומייני בלב ליבה של האליטה הדתית." },
        { label: "מוצא: ח'ומייני (Khomeini)", content: "ניסבה גאוגרפית המקשרת אותו לעיר ח'ומיין. במהלך המהפכה, השם 'ח'ומייני' הפך למטען אידיאולוגי שחצה גבולות גאוגרפיים, והפך לסמל של התנגדות עולמית לאימפריאליזם." }
      ],
      earlyLife: {
        background: "נולד בח'ומיין למשפחה שבה המנהיגות הדתית הייתה תורשתית. אביו, אייתוללה מוסטפא מוסאווי, נרצח במארב של בעלי קרקעות כשהיה רוחאללה תינוק בן חמישה חודשים בלבד. יתמות זו תחת צל של רצח פוליטי הניחה את היסודות לזעמו על אי-צדק חברתי.",
        family: "גודל בסביבה נשית דומיננטית על ידי אמו האג'ר ודתו סהיבה. בשנת 1918, בגיל 15 בלבד, מתו שתיהן במגפת השפעת הגדולה. האובדן המוחלט של משפחתו הפך אותו לנזיר בנשמתו, אדם שניתק קשרים רגשיים והתמסר טוטאלית למשימה הרוחנית.",
        education: "נחשב ל'עילוי' יוצא דופן בסמינרים. נמשך ל'אירפאן' (מיסטיקה אסלאמית) ולפילוסופיה היוונית (אפלטון). האמין כי החכם אינו צריך רק ללמד, אלא לשלוט. תפיסתו המיסטית התמזגה מאוחר יותר בשיטתו הפוליטית - שלטון חכם ההלכה."
      },
      clothing: [
        { item: "העמאמה (Amama) - הטורבן השחור של הסייד", content: "הטורבן השחור הוא 'כתר הדם' של ח'ומייני, המסמן את ייחוסו הישיר לנביא מוחמד. הטורבן היה מלופף בצורה רחבה, מסיבית ויציבה במיוחד, ששידרה מונומנטליות של סמכות עתיקה. בניגוד לאנשי דת אחרים שחבשו טורבנים קטנים, הטורבן של ח'ומייני היה הצהרה על יציבות שלטונית אבסולוטית שאינה מושפעת מאופנות חולפות או מלחצים חיצוניים. הקיפול המדויק נועד להקרין נוכחות פיזית מרשימה שמעוררת יראת כבוד דתית עמוקה." },
        { item: "העבאא (Aba) - גלימת הסגפנות (Zuhd)", content: "גלימתו של ח'ומייני הייתה עשויה מצמר כבשים פשוט, גס וכהה, ללא כל עיטורים או רקמה יקרה. לבוש זה היה הצהרה חזותית של 'זוהד' (סגפנות) מוחלטת כנגד הראוותנות המערבית והמלוכנית של תקופת השאה. הגלימה סימלה את הדחייה המוחלטת של העולם הגשמי ('אל-דוניא') ואת ההתמקדות המוחלטת בעולם הרוח ובמאבק המוסרי של המדוכאים ('מסתזעפין'). כל קפל בגלימה נועד לשדר פשטות של לוחם רוחני." },
        { item: "הנאליין (Na'lin) - סנדלי המדרש המסורתיים", content: "ח'ומייני הקפיד לנעול סנדלי עור פשוטים וחשופים, סממן מובהק של איש דת המקדיש את זמנו ללימוד ותפילה. הפשטות של הנעליים סימלה את היותו 'אחד מהעם', מנהיג שאינו צועד על שטיחי פאר קיסריים אלא על האדמה הפשוטה של מאמיניו, ומחובר לשורשים הכפריים של איראן." }
      ],
      ideology: { core: "ולאית-י פקיה (שלטון חכם ההלכה)", details: "הפיכת התאולוגיה השיעית מאמונה פסיבית לתנועה פוליטית אקטיבית. קביעה כי בתקופת ההסתרה, הסמכות הפוליטית המוחלטת חייבת להימצא בידי חכם הדת הצודק ביותר." },
      achievements: { list: ["הפלת השאה והקמת הרפובליקה האסלאמית", "ניהול המדינה ב-8 שנות מלחמת איראן-עיראק", "הפיכת האסלאם הפוליטי לכוח גלובלי", "שינוי מבני מוחלט של החברה האיראנית"] },
      rise: { reason: "הפיכתו לסמל התנגדות בלתי מתפשר לשאה מהגלות בצרפת.", year: "1979" }
    },
    {
      id: "leader_2",
      fullName: "סייד עלי חוסייני ח'אמנאי",
      role: "המנהיג העליון השני של איראן",
      years: "1939–הווה",
      imageUrl: "https://i.postimg.cc/wtpFXLvc/1770134687898.png",
      etymology: [
        { label: "תואר: סייד (Sayyid)", content: "מציין ייחוס ישיר לנביא מוחמד דרך פאטמה. התואר מעניק לו סמכות רוחנית עליונה על כל המוסלמים השיעים ומציב אותו כ'ולי אמר אל-מוסלמין'." },
        { label: "שם פרטי: עלי (Ali)", content: "על שמו של האימאם עלי בן אבי-טאלב, דמות המופת המשלבת גבורה צבאית עם חוכמה אלוהית וצדק מוחלט." },
        { label: "שושלת דם: חוסייני (Hosseini)", content: "מציין קשר דם לאימאם חוסיין, גיבור כרבלא. השם מסמל את האתוס של מאבק מעטים מול רבים ואת המוכנות להקרבה עצמית למען האמת." },
        { label: "מוצא: ח'אמנאי (Khamenei)", content: "מקור משפחתו מהעיירה ח'אמנה. מסמל את אחדות איראן - מנהיג ממוצא אזרי השולט במדינה פרסית." }
      ],
      earlyLife: {
        background: "נולד במשהד למשפחה שחיה בעוני קיצוני ומכובד. אביו, אייתוללה חאג' סייד ג'וואד, היה איש דת שמרן וסגפן שסירב לכל מגע עם השלטון המלוכני. ילדותו בבית של חדר אחד עיצבה את אידיאל 'כלכלת ההתנגדות'.",
        family: "אמו הייתה אישה משכילה שטיפחה בו את האהבה לשירה וספרות פרסית קלאסית. למרות העוני החומרי, הבית היה מלא בידע ותרבות.",
        education: "למד במדרשות של משהד ונג'ף. הפך לפעיל פוליטי רדיקלי תחת הנהגת ח'ומייני. שנותיו בכלא ועינויי המשטרה החשאית עיצבו את חשדנותו העמוקה כלפי המערב."
      },
      clothing: [
        { item: "הצ'אפייה (Chafiyeh) - כאפיית המאבק וההתנגדות", content: "האלמנט החזותי החשוב ביותר במלתחה של ח'אמנאי. הכאפייה המהפכנית מונחת תמיד על כתפיו, בניגוד לכל איש דת אחר בצמרת. זהו סמל צבאי מובהק המצהיר על סולידריות נצחית עם לוחמי הבסיג' וזכר למלחמת איראן-עיראק. היא משדרת מצב של כוננות מתמדת ומאבק בלתי פוסק נגד ה'יהירות העולמית', והופכת אותו ממנהיג דתי למנהיג מהפכני-צבאי." },
        { item: "שילוב העבאא והמקטורן (Jacket) - המנהיג הפונקציונלי", content: "ח'אמנאי נוהג ללבוש מקטורן מערבי פשוט מתחת לגלימת העבאא. השילוב הזה מסמל את הפיכת איש הדת למנהל מדינה מודרני, פונקציונר וביורוקרט. זהו לבוש המשלב בין המסורת הדתית לבין הצרכים הפרקטיים של ניהול מעצמה אזורית תחת סנקציות. המראה משדר רצינות ניהולית ויכולת לשלב בין ערכי העבר לצרכי ההווה הטכנולוגיים." },
        { item: "הטבעת (Angoshtar) - קמע של כוח והגנה", content: "ח'אמנאי נוהג לענוד טבעות עם אבנים יקרות למחצה (כמו עקיק או דור-י נג'ף), שלפי האמונה השיעית מעניקות הגנה מיסטית וברכה אלוהית. הטבעת על ידו הימנית (שידו המשותקת מהתנקשות ב-1981) הפכה לסמל חזותי המזוהה עם הישרדותו, כוחו העילאי והקשר המיסטי שלו לסמכות האלוהית בניהול ענייני המדינה." }
      ],
      ideology: { core: "עצמאות טוטאלית וחשדנות מהמערב", details: "תפיסה לפיה על איראן להיות חסינה מפני השפעה תרבותית וכלכלית מערבית דרך בניית עוצמה צבאית וטכנולוגית פנימית." },
      achievements: { list: ["שימור יציבות המשטר מעל 35 שנה", "הפיכת איראן למעצמה אזורית רחבה", "קידום פרויקטי הגרעין והטילים", "ביסוס ציר ההתנגדות האזורי"] },
      rise: { reason: "נאמנותו המוחלטת לח'ומייני וקשריו עם משמרות המהפכה.", year: "1989" }
    },
    {
      id: "leader_3",
      fullName: "מוחמד רזא פהלווי",
      role: "השאה האחרון של איראן",
      years: "1919–1980",
      imageUrl: "https://i.postimg.cc/3dxyzRyk/1770133509758.png",
      etymology: [
        { label: "שם פרטי: מוחמד (Mohammad)", content: "נבחר כדי להעניק לשושלת החילונית לגיטימציה דתית ומוסלמית מסורתית מול ההמונים." },
        { label: "שם פרטי: רזא (Reza)", content: "על שמו של האימאם השמיני עלי א-רזא. ניסיון לקשור את המלוכה לקדושה הלאומית-דתית העמוקה ביותר של העם הפרסי." },
        { label: "שם שושלת: פהלווי (Pahlavi)", content: "נגזר מהשפה הפרסית האמצעית. השם נועד למחוק את העבר הקאג'ארי ה'נחשל' ולהתחבר לתפארת האימפריות של כורש ודריווש." }
      ],
      earlyLife: {
        background: "נולד בטהראן כבנו של קצין שהפך למלך. גדל בחינוך צבאי נוקשה מאוד תחת פיקוחו של אביו הסמכותי והמאיים, רזא שאה.",
        family: "חייו האישיים היו רוויים בדרמות פוליטיות. תמיד הרגיש צורך להוכיח שהוא ראוי לכתר שניתן לו במתנה על ידי בעלות הברית.",
        education: "המלך האיראני הראשון שחונך במערב (שווייץ). חזר לאיראן עם הערצה עיוורת למודרנה אירופית וניכור מסוים מהמסורות הדתיות."
      },
      clothing: [
        { item: "מדי השרד (Uniform) הקיסריים - סמל המפקד העליון", content: "המדים הצבאיים של השאה היו יצירת אמנות של פאר קיסרי: הם היו עטורים בדרגות זהב כבדות, כותפות רחבות, ואותות גבורה המייצגים את הקשר לאימפריה הפרסית העתיקה. המדים נועדו להדגיש את שליטתו המוחלטת בצבא ואת תדמיתו כ'ארייה-מיהר' (אור האריות), מגן האומה הפרסית המודרנית והחזקה ביותר במזרח התיכון." },
        { item: "חליפות סאביל רו (Savile Row) - הסטייל המערבי", content: "בהופעותיו האזרחיות לבש השאה חליפות יוקרה שנתפרו במיטב בתי האופנה בלונדון ובפריז. זו הייתה הצהרה אידיאולוגית מובהקת: איראן היא מדינה מודרנית, חילונית, אלגנטית וקפיטליסטית המסתכלת לעבר המערב. לבוש זה נועד להציגו כמנהיג קוסמופוליטי השווה במעמדו למלכי אירופה ולנשיאי ארה\"ב, ומנותק לחלוטין מהחזות ה'נחשלת' של אנשי הדת." },
        { item: "כתר פהלווי ואבני החושן - הריבונות המוחלטת", content: "בטקסים הרשמיים עטה השאה את הכתר המשובץ באלפי יהלומים ופנינים. הכתר ייצג את השושלת החדשה ואת הריבונות הפרסית המתחדשת. העובדה שהניח את הכתר על ראשו בעצמו סימלה את העובדה שכוחו נובע מההיסטוריה הפרסית האדירה ולא מהסכמה של הממסד הדתי, עליו הוא ביקש לשלוט." }
      ],
      ideology: { core: "לאומיות פרסית חילונית ומודרניזציה", details: "אמונה שהאסלאם הוא מרכיב משני בזהות האיראנית, ושעל איראן לחזור לשורשיה האריים ולהפוך למעצמה תעשייתית בסגנון מערבי." },
      achievements: { list: ["המהפכה הלבנה ורפורמות חברתיות רחבות", "קידום מעמד האישה ומתן זכות בחירה", "בניית אחד הצבאות החזקים בעולם בשנות ה-70", "חגיגות 2,500 שנה לאימפריה הפרסית"] },
      rise: { reason: "ירושת הכתר לאחר הדחת אביו על ידי בעלות הברית.", year: "1941" }
    },
    {
      id: "leader_4",
      fullName: "מוחמד מוסאדק",
      role: "ראש הממשלה הלאומני של איראן",
      years: "1882–1967",
      imageUrl: "https://i.postimg.cc/7fZCj6CC/1770133514666.png",
      etymology: [
        { label: "שם פרטי: מוחמד (Mohammad)", content: "מייצג את המוסר האסלאמי האישי שלו, שהיה מבוסס על יושרה וצדק חברתי יותר מאשר דוגמה דתית." },
        { label: "שם משפחה: מוסאדק (Mossadegh)", content: "משמעות: 'איש האמת' או 'המאומת'. הוא אימץ את השם כזהות פוליטית - המנהיג שאינו משקר לעמו ושאינו נכנע." }
      ],
      earlyLife: {
        background: "נולד לאצולה הגבוהה ביותר של שושלת הקאג'אר. אמו הייתה נסיכה ואביו שר האוצר. למרות עושרו, ראה מקרוב את הריקבון של השלטון האבסולוטי.",
        family: "היה אדם רגשן מאוד שנתפס באיראן כסימן לכנות וסבל של מנהיג אוהב המקריב את נוחותו האישית.",
        education: "האיראני הראשון שקיבל דוקטורט למשפטים מאירופה (שווייץ). היה דמוקרט בנשמתו שהאמין בשלטון החוק כבלם נגד עריצות."
      },
      clothing: [
        { item: "הפאי-ג'אמה (Pajamas) - הפיג'מה ככלי של תעמולה", content: "מוסאדק הפך את הפיג'מה שלו לכלי פוליטי גאוני. על ידי קבלת פני דיפלומטים ומנהיגים במיטתו כשהוא לבוש בפיג'מה, הוא שידר: 'אני זקן, חלש וחולה פיזית, אך רוחי הלאומית בלתי ניתנת לשבירה'. הלבוש הלא-רשמי הזה הדגיש את עוצמתו המוסרית ואת הקרבתו המוחלטת לקופה הלאומית, ויצר דמות של סמל לסבל ולמסירות עבור האומה האיראנית כולה." },
        { item: "מעיל הצמר האפור והפשוט - האזרח הלאומן", content: "כאשר הופיע בציבור, לבש מוסאדק מעילים ארוכים ופשוטים בגוונים ניטרליים. המראה שלו היה של אינטלקטואל, פרופסור או משפטן מכובד אך צנוע, בניגוד מוחלט למדים הנוצצים של השאה. המעיל סימל את המנהיג האזרחי שדואג לצדק חברתי ולריבונות של 'האדם הפשוט' ולא למחלצות של חצר המלוכה." }
      ],
      ideology: { core: "לאומיות דמוקרטית ואנטי-קולוניאליזם", details: "האמונה שאיראן חייבת לשלוט במשאביה הטבעיים (נפט) כדי להיות ריבונית באמת, ושעל השאה למלוך אך לא למשול." },
      achievements: { list: ["הלאמת תעשיית הנפט ב-1951", "מאבק משפטי מוצלח ומרהיב בהאג", "צמצום כוחו הדיקטטורי של השאה", "סמל עולמי לאנטי-קולוניאליזם"] },
      rise: { reason: "תמיכה עממית עצומה ותמיכת הפרלמנט במאבק הלאמת הנפט.", year: "1951" }
    }
  ], []);

  // 1. Auth & Data Synchronization
  useEffect(() => {
    const initApp = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (err) { console.error("Auth error:", err); }
    };
    initApp();
    const unsubAuth = onAuthStateChanged(auth, setUser);
    return () => unsubAuth();
  }, []);

  useEffect(() => {
    if (!user) return;
    const leadersRef = collection(db, 'artifacts', appId, 'public', 'data', 'leaders');
    
    // Set local data first for immediate display
    setLeaders(initialResearchData);
    setLoading(false);

    const unsubSnap = onSnapshot(leadersRef, (snap) => {
      if (!snap.empty) {
        const cloudData = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        setLeaders(cloudData);
      } else {
        // Seed if cloud is empty
        initialResearchData.forEach(async (leader) => {
          await setDoc(doc(leadersRef, leader.id), leader);
        });
      }
    }, (err) => console.error("Sync Error:", err));

    return () => unsubSnap();
  }, [user, initialResearchData]);

  const filteredLeaders = useMemo(() => {
    return leaders.filter(l => 
      l.fullName.includes(searchTerm) || l.role.includes(searchTerm)
    );
  }, [leaders, searchTerm]);

  return (
    <div className="min-h-screen flex flex-col bg-slate-950 text-slate-100 font-['Assistant']">
      
      {/* Navbar - S25 Ultra Optimized */}
      <nav className="border-b border-slate-800 bg-slate-900/80 backdrop-blur-xl sticky top-0 z-50">
        <div className="max-w-4xl mx-auto px-4">
          <div className="flex items-center h-16 gap-3">
            <button className="flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold bg-slate-800 text-slate-300 active:scale-95">
              <Home className="w-4 h-4" />
              <span>ראשי</span>
            </button>
            <div className="h-6 w-px bg-slate-800"></div>
            <div className="flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold bg-blue-600 text-white shadow-lg">
              <ShieldCheck className="w-4 h-4" />
              <span>מנהיגי מדינה</span>
            </div>
          </div>
        </div>
      </nav>

      <main className="flex-grow max-w-4xl mx-auto px-6 py-12 md:py-16 space-y-12">
        <header className="space-y-6">
          <div className="flex items-center gap-4">
            <div className="p-4 bg-blue-500/10 rounded-[2rem] border border-blue-500/20">
              <ShieldCheck className="w-12 h-12 text-blue-500" />
            </div>
            <div>
              <h1 className="text-4xl md:text-6xl font-black tracking-tighter text-white">מנהיגי מדינה</h1>
              <p className="text-blue-500 font-medium text-lg">מחקר אנתרופולוגי מעמיק (מבוסס ענן)</p>
            </div>
          </div>
          
          <div className="relative group max-w-md">
            <Search className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 w-5 h-5" />
            <input 
              type="text" 
              placeholder="חיפוש מנהיג..."
              className="w-full bg-slate-900/50 border border-slate-800 rounded-2xl py-4 pr-12 pl-4 text-sm focus:outline-none focus:border-blue-500/50 transition-all shadow-inner"
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </header>

        {loading ? (
            <div className="flex flex-col items-center justify-center py-20 gap-4">
                <Loader2 className="w-10 h-10 text-blue-500 animate-spin" />
                <p className="text-slate-500 text-xs font-bold uppercase tracking-widest">טוען מחקר מעמיק...</p>
            </div>
        ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20">
                {filteredLeaders.map(leader => (
                    <div 
                        key={leader.id}
                        onClick={() => setSelectedLeader(leader)}
                        className="bg-slate-900/40 border border-slate-800 rounded-[2.5rem] p-6 flex gap-6 cursor-pointer hover:border-blue-500/40 transition-all group relative overflow-hidden active:scale-[0.97]"
                    >
                        <div className="w-24 h-24 rounded-3xl overflow-hidden border border-slate-700 shrink-0 bg-slate-800 shadow-xl relative">
                            <img src={leader.imageUrl} className="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-1000 scale-110 group-hover:scale-100" />
                        </div>
                        <div className="flex flex-col justify-center min-w-0">
                            <h2 className="text-xl font-bold text-white truncate group-hover:text-blue-400 transition-colors">{leader.fullName}</h2>
                            <p className="text-blue-500 text-[10px] font-black uppercase tracking-widest mt-1">{leader.years}</p>
                            <p className="text-slate-400 text-xs mt-2 line-clamp-2 leading-relaxed font-light">{leader.role}</p>
                        </div>
                    </div>
                ))}
            </div>
        )}
      </main>

      {/* Research Modal */}
      {selectedLeader && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-0 md:p-6 overflow-hidden">
          <div className="absolute inset-0 bg-slate-950/98 backdrop-blur-2xl" onClick={() => setSelectedLeader(null)}></div>
          <div className="relative w-full max-w-4xl bg-slate-900 md:rounded-[3.5rem] h-full md:h-auto md:max-h-[92vh] overflow-y-auto no-scrollbar border border-slate-800 shadow-2xl flex flex-col">
            
            {/* Header - NOT STICKY - Scrolls with content as requested */}
            <div className="p-8 md:p-12 border-b border-slate-800/50 flex justify-between items-center">
              <div className="flex items-center gap-6">
                <div 
                    className="w-20 h-20 rounded-[2rem] overflow-hidden border-2 border-blue-500/30 bg-slate-800 shadow-2xl cursor-zoom-in group relative"
                    onClick={(e) => { e.stopPropagation(); setZoomedImage(selectedLeader.imageUrl); }}
                >
                  <img src={selectedLeader.imageUrl} className="w-full h-full object-cover" />
                  <div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                      <ZoomIn className="text-white w-6 h-6" />
                  </div>
                </div>
                <div>
                  <h2 className="text-3xl font-black text-white tracking-tighter mb-1">{selectedLeader.fullName}</h2>
                  <span className="px-3 py-1 bg-blue-500/10 border border-blue-500/20 rounded-full text-[10px] text-blue-500 font-black tracking-widest uppercase">
                    {selectedLeader.years}
                  </span>
                </div>
              </div>
              <button onClick={() => setSelectedLeader(null)} className="p-4 bg-slate-800 hover:bg-slate-700 rounded-2xl text-slate-400 hover:text-white transition-all active:scale-90">
                <X className="w-6 h-6" />
              </button>
            </div>

            <div className="p-8 md:p-16 space-y-24">
              
              {/* Etymology Section - Deepened */}
              <section className="space-y-12">
                <div className="flex items-center gap-6">
                  <div className="bg-blue-600/20 p-3 rounded-2xl"><Fingerprint className="text-blue-500 w-6 h-6" /></div>
                  <h3 className="text-white font-black text-xl tracking-tight uppercase tracking-widest underline decoration-blue-500 decoration-4 underline-offset-8">ניתוח אטימולוגי ושושלתי מורחב</h3>
                </div>
                <div className="grid gap-8">
                  {selectedLeader.etymology.map((et, i) => (
                    <div key={i} className="relative group">
                      <div className="absolute -right-4 top-0 bottom-0 w-1 bg-blue-600/20 group-hover:bg-blue-600 transition-colors rounded-full"></div>
                      <div className="p-10 bg-slate-800/30 rounded-[2.5rem] border border-slate-800/50">
                        <span className="text-blue-500 font-black block mb-4 text-xs uppercase tracking-[0.3em]">{et.label}</span>
                        <p className="text-xl leading-relaxed text-justify text-slate-200 font-light">{et.content}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </section>

              {/* Early Life Section */}
              <section className="space-y-12">
                <div className="flex items-center gap-6">
                  <div className="bg-blue-600/20 p-3 rounded-2xl"><BookOpen className="text-blue-500 w-6 h-6" /></div>
                  <h3 className="text-white font-black text-xl tracking-tight uppercase tracking-widest underline decoration-blue-500 decoration-4 underline-offset-8">ילדות, משפחה וחינוך מוקדם</h3>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-1 gap-6">
                  <div className="p-8 bg-slate-800/20 rounded-[2.5rem] border border-slate-800/50">
                    <h4 className="text-blue-500 font-black text-[10px] uppercase mb-6 tracking-widest">רקע ביוגרפי ונסיבות לידה</h4>
                    <p className="text-slate-300 text-lg leading-relaxed font-light text-justify">{selectedLeader.earlyLife.background}</p>
                  </div>
                  <div className="p-8 bg-slate-800/20 rounded-[2.5rem] border border-slate-800/50">
                    <h4 className="text-blue-500 font-black text-[10px] uppercase mb-6 tracking-widest">הקשר משפחתי ודמויות השפעה</h4>
                    <p className="text-slate-300 text-lg leading-relaxed font-light text-justify">{selectedLeader.earlyLife.family}</p>
                  </div>
                  <div className="p-8 bg-slate-800/20 rounded-[2.5rem] border border-slate-800/50">
                    <h4 className="text-blue-500 font-black text-[10px] uppercase mb-6 tracking-widest">מסלול השכלה והכשרה רוחנית</h4>
                    <p className="text-slate-300 text-lg leading-relaxed font-light text-justify">{selectedLeader.earlyLife.education}</p>
                  </div>
                </div>
              </section>

              {/* Clothing Section - Deeply Expanded as requested */}
              <section className="space-y-12">
                <div className="flex items-center gap-6">
                  <div className="bg-blue-600/20 p-3 rounded-2xl"><Pocket className="text-blue-500 w-6 h-6" /></div>
                  <h3 className="text-white font-black text-xl tracking-tight uppercase tracking-widest underline decoration-blue-500 decoration-4 underline-offset-8">ניתוח לבוש וסממנים חזותיים מורחב</h3>
                </div>
                <div className="grid grid-cols-1 gap-8">
                  {selectedLeader.clothing.map((cl, i) => (
                    <div key={i} className="p-10 bg-slate-800/50 rounded-[3rem] border border-slate-700/50 group hover:bg-slate-800/80 transition-all">
                      <h4 className="font-black text-white mb-4 text-2xl tracking-tight group-hover:text-blue-400 transition-colors border-r-4 border-blue-500 pr-5">{cl.item}</h4>
                      <p className="text-xl opacity-90 text-justify leading-relaxed text-slate-300 font-light">{cl.content}</p>
                    </div>
                  ))}
                </div>
              </section>

              {/* Ideology and Achievements */}
              <section className="p-12 bg-blue-600/10 rounded-[4rem] border border-blue-500/20 relative overflow-hidden">
                <span className="text-blue-500 font-black text-[10px] uppercase tracking-[0.4em]">תפיסה אידיאולוגית ופוליטית</span>
                <h3 className="text-3xl md:text-5xl font-black text-white tracking-tighter leading-tight mt-6">{selectedLeader.ideology.core}</h3>
                <p className="text-xl opacity-90 italic text-justify leading-relaxed text-slate-300 font-light pr-10 border-r-4 border-blue-500/30 mt-6">{selectedLeader.ideology.details}</p>
              </section>

              <section className="pb-20 space-y-12">
                <h3 className="text-white font-black text-xl tracking-tight uppercase tracking-widest underline decoration-blue-500 decoration-4 underline-offset-8">הישגים ותרומה היסטורית</h3>
                <div className="grid gap-4">
                  {selectedLeader.achievements.list.map((ach, i) => (
                    <div key={i} className="flex gap-6 items-start p-8 bg-slate-800/40 rounded-[2rem] border border-slate-800 group hover:border-blue-500/30 transition-all">
                      <div className="w-4 h-4 rounded-full bg-blue-600 mt-2 shrink-0 group-hover:scale-125 transition-transform"></div>
                      <span className="text-slate-200 text-xl leading-relaxed font-light">{ach}</span>
                    </div>
                  ))}
                </div>
              </section>
            </div>
          </div>
        </div>
      )}

      {/* Zoom Modal */}
      {zoomedImage && (
          <div className="fixed inset-0 z-[200] bg-black/95 backdrop-blur-xl flex items-center justify-center p-4 cursor-zoom-out" onClick={() => setZoomedImage(null)}>
              <img src={zoomedImage} className="max-w-full max-h-full rounded-2xl shadow-2xl object-contain animate-fade-in" />
          </div>
      )}

      <footer className="mt-auto py-16 text-center opacity-40">
          <div className="flex justify-center gap-4 mb-4">
            <Database className="w-4 h-4" /><Binary className="w-4 h-4" /><Cpu className="w-4 h-4" />
          </div>
        <p className="text-[10px] uppercase tracking-[0.5em] font-black text-slate-600">
          © 2026 מרכז המחקר האנתרופולוגי - S25 ULTRA OPTIMIZED
        </p>
      </footer>
    </div>
  );
};

export default App;

